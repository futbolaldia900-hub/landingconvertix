<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel Admin - Registrar Compras</title>
</head>
<body style="font-family:Arial; margin:40px;">
  <h2>Registrar compra manual</h2>

  <label>Click ID:</label><br/>
  <input id="click_id" placeholder="Ej: SD6EK" style="width:200px;"/><br/><br/>

  <label>Tel√©fono del comprador (sin +):</label><br/>
  <input id="phone" placeholder="549XXXXXXXXXX" style="width:200px;"/><br/><br/>

  <label>Monto (ARS):</label><br/>
  <input id="value" placeholder="Ej: 3000" style="width:200px;"/><br/><br/>

  <button id="send" style="padding:10px 20px;">Enviar a Meta</button>

  <p id="status"></p>

  <script>
    // üîë CONFIGURACI√ìN B√ÅSICA
    const ACCESS_TOKEN = "TU_TOKEN_DE_ACCESO_DE_META"; // reemplaz√° con tu token real
    const PIXEL_ID = "1946841772846486";

    // üß† MODO MANUAL DE PRUEBA
    // Copi√° estos valores desde tu Google Sheet para cada test
    const fbp = "fb.2.1762644068517.778233856327572830"; // valor tomado del sheet
    const fbc = ""; // si en el sheet aparece vac√≠o, dejalo as√≠
    const event_id = "contact-SD6EK"; // valor tomado del sheet

    document.getElementById("send").addEventListener("click", async () => {
      const click_id = document.getElementById("click_id").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const value = parseFloat(document.getElementById("value").value.trim());
      const status = document.getElementById("status");

      if (!click_id || !phone || !value) {
        status.textContent = "‚ö†Ô∏è Completa todos los campos.";
        return;
      }

      status.textContent = "Enviando datos a Meta...";

      try {
        // üì¶ Construir payload
        const payload = {
          data: [{
            event_name: "Purchase",
            event_time: Math.floor(Date.now() / 1000),
            event_id: event_id, // el mismo que guardaste desde el click
            user_data: {
              ph: phone,
              fbp: fbp,
              fbc: fbc
            },
            custom_data: {
              value: value,
              currency: "ARS"
            }
          }]
        };

        // üöÄ Enviar a Meta CAPI
        const response = await fetch(`https://graph.facebook.com/v18.0/${PIXEL_ID}/events?access_token=${ACCESS_TOKEN}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const json = await response.json();

        if (json.events_received) {
          status.textContent = "‚úÖ Compra registrada correctamente en Meta.";
        } else {
          status.textContent = "‚ö†Ô∏è Error al enviar a Meta: " + JSON.stringify(json);
        }

      } catch (err) {
        status.textContent = "‚ùå Error: " + err.message;
      }
    });
  </script>
</body>
</html>
