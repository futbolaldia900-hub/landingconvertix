<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel Admin - Registrar Compras</title>
</head>
<body style="font-family:Arial; margin:40px;">
  <h2>Registrar compra manual</h2>

  <label>Click ID (c√≥digo corto):</label><br/>
  <input id="click_id" placeholder="Ej: A3F9KQ" style="width:250px;"/><br/><br/>

  <label>Tel√©fono del comprador (sin +):</label><br/>
  <input id="phone" placeholder="549XXXXXXXXXX" style="width:250px;"/><br/><br/>

  <label>Monto (ARS):</label><br/>
  <input id="value" placeholder="Ej: 3000" style="width:250px;"/><br/><br/>

  <label>FBP:</label><br/>
  <input id="fbp" placeholder="fb.2.xxxxx..." style="width:400px;"/><br/><br/>

  <label>FBC:</label><br/>
  <input id="fbc" placeholder="fb.1.xxxxx..." style="width:400px;"/><br/><br/>

  <label>Event ID:</label><br/>
  <input id="event_id" placeholder="contact-XXXXXX" style="width:400px;"/><br/><br/>

  <button id="send" style="padding:10px 25px;">Enviar a Meta</button>

  <p id="status" style="margin-top:20px; font-weight:bold;"></p>

  <script>
    // üîß CONFIGURACI√ìN
    const ACCESS_TOKEN = "TU_TOKEN_DE_ACCESO_DE_META"; // <-- reemplaz√° con tu token v√°lido
    const PIXEL_ID = "1946841772846486";

    document.getElementById("send").addEventListener("click", async () => {
      const click_id = document.getElementById("click_id").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const value = parseFloat(document.getElementById("value").value.trim());
      const fbp = document.getElementById("fbp").value.trim();
      const fbc = document.getElementById("fbc").value.trim();
      const event_id = document.getElementById("event_id").value.trim();
      const status = document.getElementById("status");

      if (!click_id || !phone || !value || !fbp || !fbc || !event_id) {
        status.textContent = "‚ö†Ô∏è Por favor complet√° todos los campos.";
        return;
      }

      status.textContent = "‚è≥ Enviando evento a Meta...";

      try {
        const payload = {
          data: [{
            event_name: "Purchase",
            event_time: Math.floor(Date.now() / 1000),
            event_id: event_id,
            user_data: {
              ph: phone,  // se puede hashear en una versi√≥n avanzada
              fbp: fbp,
              fbc: fbc
            },
            custom_data: {
              value: value,
              currency: "ARS"
            }
          }]
        };

        const response = await fetch(
          `https://graph.facebook.com/v18.0/${PIXEL_ID}/events?access_token=${ACCESS_TOKEN}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          }
        );

        const json = await response.json();
        if (json.events_received) {
          status.textContent = "‚úÖ Compra registrada correctamente en Meta.";
        } else {
          status.textContent = "‚ö†Ô∏è Error al enviar a Meta: " + JSON.stringify(json);
        }
      } catch (err) {
        status.textContent = "‚ùå Error: " + err.message;
      }
    });
  </script>
</body>
</html>
