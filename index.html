<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Acceso VIP Club</title>

  <!-- META PIXEL -->
  <script>
    !function(f,b,e,v,n,t,s){
      if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)
    }(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
    
    fbq('init', '1946841772846486'); // Pixel Principal - Imperio Esmeralda
    fbq('track', 'PageView');
  </script>
</head>

<body style="font-family: Arial; text-align:center; margin-top:50px;">
  <h1>ðŸŽ° Acceso VIP Club</h1>
  <p>Bienvenido al club. RecibÃ­ tu bono de bienvenida.</p>
  <button id="whatsapp-btn" style="padding:15px 25px; font-size:18px; border:none; background:#25D366; color:white; border-radius:10px; cursor:pointer;">
    Ir a WhatsApp
  </button>

  <script>
    // === CONFIGURACIÃ“N ===
    const WHATSAPP_NUMBER = "5492236735372";
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbyLFak680IPUvpfru7WAkqQO8s63dCpLOLD_8RPa0L4eiFWU1EwXRYJbHrKK8xLokEK/exec"; // ðŸ”¹ Reemplaza luego con tu URL del Apps Script desplegado

    // === FUNCIONES AUXILIARES ===
    function getCookie(name) {
      const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
      return match ? match[2] : '';
    }

    function generateShortID() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let result = '';
      for (let i = 0; i < 6; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
      return result;
    }

    // === CAPTURA DE DATOS Y ENVÃO ===
    document.getElementById('whatsapp-btn').addEventListener('click', async () => {
      const fbp = getCookie('_fbp');
      const fbc = getCookie('_fbc') || (window.location.search.match(/fbclid=([^&]+)/) ? 'fb.1.' + Date.now() + '.' + RegExp.$1 : '');
      const click_id = generateShortID();
      const event_id = 'contact-' + click_id;
      const timestamp = new Date().toISOString();

      // Enviar a Google Sheets
      const payload = { timestamp, click_id, fbp, fbc, event_id };
      try {
        await fetch(SHEET_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
      } catch (err) {
        console.warn("Error al enviar al sheet:", err);
      }

      // Redirigir a WhatsApp con cÃ³digo camuflado
      const invisibleSpaces = "%E2%80%8E%E2%80%8E%E2%80%8E"; // Espacios invisibles
      const message = `Hola, quiero crear mi usuario.${invisibleSpaces}Mi cÃ³digo es ${click_id}`;
      window.location.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
    });
  </script>
</body>
</html>

